# Todo 애플리케이션 백엔드 API 연동 개발 계획

## 1. 프로젝트 개요

### 1.1 현재 상태
- **프론트엔드**: React 기반 Todo 애플리케이션
  - 로컬 state로만 데이터 관리 (메모리 기반)
  - 기능: 할 일 추가, 완료 토글, 삭제
  - 데이터 구조: `{ id, text, completed }`
  
- **백엔드**: Spring Boot 3.4.12 기본 구조만 존재
  - API 엔드포인트 없음
  - 데이터베이스 연동 설정 없음

### 1.2 목표
- 백엔드에 RESTful API 구축
- MySQL 데이터베이스에 Todo 데이터 영구 저장
- 프론트엔드와 백엔드 API 연동

---

## 2. 데이터베이스 설계

### 2.1 데이터베이스 정보
- **데이터베이스명**: `tododb`
- **URL**: `jdbc:mysql://localhost:3306/tododb?allowPublicKeyRetrieval=true&useSSL=false&serverTimezone=Asia/Seoul&characterEncoding=UTF-8`
- **사용자명**: `todouser`
- **비밀번호**: `todo1234`
- **드라이버**: `com.mysql.cj.jdbc.Driver`

### 2.2 테이블 설계
**todo 테이블**
```sql
CREATE TABLE todo (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    text VARCHAR(500) NOT NULL,
    completed BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

### 2.3 엔티티 필드
- `id`: Long (자동 증가, Primary Key)
- `text`: String (할 일 내용)
- `completed`: Boolean (완료 여부)
- `createdAt`: LocalDateTime (생성 시간)
- `updatedAt`: LocalDateTime (수정 시간)

---

## 3. 백엔드 개발 계획

### 3.1 Phase 1: 데이터베이스 설정 및 엔티티 생성

#### 3.1.1 application.properties 설정
- **파일**: `backend/src/main/resources/application.properties`
- **설정 내용**:
  ```properties
  # 데이터베이스 연결 설정
  spring.datasource.url=jdbc:mysql://localhost:3306/tododb?allowPublicKeyRetrieval=true&useSSL=false&serverTimezone=Asia/Seoul&characterEncoding=UTF-8
  spring.datasource.username=todouser
  spring.datasource.password=todo1234
  spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
  
  # JPA 설정
  spring.jpa.hibernate.ddl-auto=update
  spring.jpa.show-sql=true
  spring.jpa.properties.hibernate.format_sql=true
  spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLDialect
  
  # 서버 포트 설정 (선택사항)
  server.port=8080
  ```

#### 3.1.2 Todo 엔티티 생성
- **파일**: `backend/src/main/java/org/example/backend/entity/Todo.java`
- **구현 내용**:
  - `@Entity`, `@Table` 어노테이션
  - `@Id`, `@GeneratedValue` (AUTO_INCREMENT)
  - `@Column` 어노테이션으로 필드 매핑
  - `@CreationTimestamp`, `@UpdateTimestamp` 또는 `@PrePersist`, `@PreUpdate` 사용
  - 기본 생성자, 전체 생성자, Getter/Setter 또는 Lombok 사용

#### 3.1.3 Repository 인터페이스 생성
- **파일**: `backend/src/main/java/org/example/backend/repository/TodoRepository.java`
- **구현 내용**:
  - `JpaRepository<Todo, Long>` 상속
  - 기본 CRUD 메서드 자동 제공

---

### 3.2 Phase 2: DTO 및 Service 계층 구현

#### 3.2.1 DTO 클래스 생성
- **파일**: `backend/src/main/java/org/example/backend/dto/TodoRequest.java`
  - 할 일 생성/수정 요청용 DTO
  - 필드: `text`, `completed`
  
- **파일**: `backend/src/main/java/org/example/backend/dto/TodoResponse.java`
  - 할 일 응답용 DTO
  - 필드: `id`, `text`, `completed`, `createdAt`, `updatedAt`

#### 3.2.2 Service 클래스 생성
- **파일**: `backend/src/main/java/org/example/backend/service/TodoService.java`
- **구현 메서드**:
  - `getAllTodos()`: 모든 할 일 조회
  - `getTodoById(Long id)`: ID로 할 일 조회
  - `createTodo(TodoRequest request)`: 할 일 생성
  - `updateTodo(Long id, TodoRequest request)`: 할 일 수정
  - `deleteTodo(Long id)`: 할 일 삭제
  - `toggleTodo(Long id)`: 완료 상태 토글

---

### 3.3 Phase 3: REST API Controller 구현

#### 3.3.1 TodoController 생성
- **파일**: `backend/src/main/java/org/example/backend/controller/TodoController.java`
- **구현 엔드포인트**:
  ```
  GET    /api/todos          - 모든 할 일 조회
  GET    /api/todos/{id}     - 특정 할 일 조회
  POST   /api/todos          - 할 일 생성
  PUT    /api/todos/{id}     - 할 일 수정
  PATCH  /api/todos/{id}/toggle - 완료 상태 토글
  DELETE /api/todos/{id}     - 할 일 삭제
  ```

#### 3.3.2 CORS 설정
- **파일**: `backend/src/main/java/org/example/backend/config/CorsConfig.java`
- **설정 내용**:
  - 프론트엔드 도메인 허용 (예: `http://localhost:5173`)
  - GET, POST, PUT, PATCH, DELETE 메서드 허용
  - 필요한 헤더 허용

---

### 3.4 Phase 4: 예외 처리 및 검증

#### 3.4.1 예외 처리
- **파일**: `backend/src/main/java/org/example/backend/exception/GlobalExceptionHandler.java`
- **처리 내용**:
  - `ResourceNotFoundException`: 할 일을 찾을 수 없을 때
  - `@Valid` 검증 실패 시 에러 응답

#### 3.4.2 DTO 검증
- `@NotNull`, `@NotBlank`, `@Size` 등 Validation 어노테이션 추가
- `build.gradle`에 `spring-boot-starter-validation` 의존성 추가

---

## 4. 프론트엔드 개발 계획

### 4.1 Phase 1: API 통신 모듈 생성

#### 4.1.1 API 서비스 파일 생성
- **파일**: `frontend/src/services/todoApi.js`
- **구현 내용**:
  - `axios`를 사용한 API 호출 함수
  - 기본 URL 설정 (예: `http://localhost:8080/api/todos`)
  - 함수:
    - `getAllTodos()`
    - `getTodoById(id)`
    - `createTodo(text)`
    - `updateTodo(id, todo)`
    - `toggleTodo(id)`
    - `deleteTodo(id)`

#### 4.1.2 HTTP 클라이언트 라이브러리 선택
 `axios` 라이브러리 추가 (권장)
  ```bash
  npm install axios
  ```

---

### 4.2 Phase 2: TodoComponent 리팩토링

#### 4.2.1 상태 관리 변경
- **파일**: `frontend/src/component/TodoComponent.jsx`
- **변경 내용**:
  - 로컬 state 대신 API 호출로 데이터 관리
  - `useEffect`로 컴포넌트 마운트 시 데이터 로드
  - `addTodo`, `toggleTodo`, `deleteTodo` 함수를 API 호출로 변경
  - 로딩 상태 및 에러 처리 추가

#### 4.2.2 에러 처리 및 로딩 상태
- 로딩 중 표시 (예: "로딩 중...")
- 에러 발생 시 사용자에게 알림
- 네트워크 오류 처리

---

### 4.3 Phase 3: 사용자 경험 개선

#### 4.3.1 낙관적 업데이트 (선택사항)
- API 호출 전 UI 먼저 업데이트
- 실패 시 롤백

#### 4.3.2 입력 검증
- 빈 문자열 입력 방지
- 최대 길이 제한

---

## 5. 개발 순서 및 일정

### 5.1 백엔드 개발 순서
1. ✅ **데이터베이스 설정** (application.properties)
2. ✅ **Todo 엔티티 생성**
3. ✅ **TodoRepository 생성**
4. ✅ **DTO 클래스 생성**
5. ✅ **TodoService 구현**
6. ✅ **TodoController 구현**
7. ✅ **CORS 설정**
8. ✅ **예외 처리 구현**
9. ✅ **테스트** (Postman 또는 curl)

### 5.2 프론트엔드 개발 순서
1. ✅ **API 서비스 모듈 생성**
2. ✅ **TodoComponent 리팩토링**
3. ✅ **에러 처리 및 로딩 상태 추가**
4. ✅ **통합 테스트**

---

## 6. 테스트 계획

### 6.1 백엔드 테스트
- **단위 테스트**: Service 계층 테스트
- **통합 테스트**: Controller 테스트 (MockMvc)
- **API 테스트**: Postman 또는 curl로 실제 API 호출 테스트

#### 6.1.1 curl을 이용한 API 테스트 (Windows 환경)

**사전 준비**
1. 백엔드 서버 실행 확인 (http://localhost:8080)
2. MySQL 데이터베이스 연결 확인
3. Windows PowerShell 또는 Command Prompt에서 curl 명령어 사용 가능 확인

**테스트 순서**

1. **모든 할 일 조회 (GET)**
   ```powershell
   curl http://localhost:8080/api/todos
   ```

2. **할 일 생성 (POST)**
   ```powershell
   curl -X POST http://localhost:8080/api/todos -H "Content-Type: application/json" -d "{\"text\":\"테스트 할 일\",\"completed\":false}"
   ```

3. **특정 할 일 조회 (GET)**
   ```powershell
   curl http://localhost:8080/api/todos/1
   ```

4. **할 일 수정 (PUT)**
   ```powershell
   curl -X PUT http://localhost:8080/api/todos/1 -H "Content-Type: application/json" -d "{\"text\":\"수정된 할 일\",\"completed\":true}"
   ```

5. **완료 상태 토글 (PATCH)**
   ```powershell
   curl -X PATCH http://localhost:8080/api/todos/1/toggle
   ```

6. **할 일 삭제 (DELETE)**
   ```powershell
   curl -X DELETE http://localhost:8080/api/todos/1
   ```

**테스트 스크립트 제공**
- `backend/test-api.ps1`: PowerShell 스크립트 (권장)
  - 색상 출력 및 상세한 에러 처리
  - JSON 응답 자동 포맷팅
  - 실행: `.\test-api.ps1` 또는 `powershell -ExecutionPolicy Bypass -File test-api.ps1`
  
- `backend/test-api.bat`: Command Prompt 배치 파일
  - 간단한 curl 명령어 실행
  - 실행: `test-api.bat`

**Windows 환경 주의사항**
- PowerShell에서는 큰따옴표(`"`) 내부의 큰따옴표를 이스케이프(`\"`)해야 함
- JSON 데이터 전송 시 Content-Type 헤더 필수
- 응답을 보기 좋게 보려면 `| ConvertFrom-Json` (PowerShell) 또는 `| python -m json.tool` 사용 가능

**예상 응답 예시**
- 성공 시: HTTP 200 OK (또는 201 Created) + JSON 데이터
- 실패 시: HTTP 4xx/5xx + 에러 메시지 JSON

### 6.2 프론트엔드 테스트
- **기능 테스트**: 브라우저에서 직접 테스트
- **네트워크 테스트**: 백엔드 서버 중단 시 에러 처리 확인

### 6.3 통합 테스트
- 프론트엔드와 백엔드 동시 실행
- 전체 플로우 테스트 (생성 → 조회 → 수정 → 삭제)

---

## 7. 추가 고려사항

### 7.1 보안
- SQL Injection 방지 (JPA 사용으로 자동 방지)
- XSS 방지 (프론트엔드 입력 검증)
- CORS 설정 최소 권한 원칙

### 7.2 성능
- 페이징 처리 (할 일이 많아질 경우)
- 인덱스 추가 (필요 시)

### 7.3 확장성
- 향후 기능 추가를 위한 구조 설계
- 사용자 인증/인가 (선택사항)

---

## 8. 참고사항

### 8.1 개발 환경
- **백엔드**: Spring Boot 3.4.x, JDK 21, MySQL 8.0
- **프론트엔드**: React, JavaScript, Vite
- **데이터베이스**: MySQL 8.0

### 8.2 실행 방법
1. MySQL 데이터베이스 및 사용자 생성
2. 백엔드 서버 실행 (`./gradlew bootRun` 또는 IDE에서 실행)
3. 프론트엔드 서버 실행 (`npm run dev`)
4. 브라우저에서 `http://localhost:5173` 접속

---

## 9. 체크리스트

### 백엔드
- [ ] application.properties 데이터베이스 설정
- [ ] Todo 엔티티 생성
- [ ] TodoRepository 생성
- [ ] DTO 클래스 생성 (Request, Response)
- [ ] TodoService 구현
- [ ] TodoController 구현
- [ ] CORS 설정
- [ ] 예외 처리 구현
- [ ] API 테스트

### 프론트엔드
- [ ] API 서비스 모듈 생성
- [ ] TodoComponent 리팩토링
- [ ] 에러 처리 추가
- [ ] 로딩 상태 추가
- [ ] 통합 테스트

---

**작성일**: 2024년
**작성자**: 개발팀

